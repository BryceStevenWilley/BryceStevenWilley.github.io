<!DOCTYPE html>
<html lang="en" class="t-blue">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#0090EA">

  


  <title>Mystery Internet Bug: Text-to-Speech and The Notorious B.I.G.</title>
  <meta name="description" content="Solving random bugs on the internet with Browser Dev Tools">

  <meta property="og:title" content="Mystery Internet Bug: Text-to-Speech and The Notorious B.I.G."/>
  <meta property="og:type" content="website" />
  <meta property="og:description" content="This post was originally a tweet thread.I've added more details and background explanations where possible, and rewritten it for the blog format.">
  <meta property="og:image" content="https://brycestevenwilley.github.io/assets/headers/biggie-tts.png" />
  <meta property="og:url" content="https://brycestevenwilley.github.io/2022/04/fpt_tts_biggie">
  <meta property="og:image:alt" content="A diagram of a 3 step plan. Step 1: text-to-speech (represented by an audio icon). Step 2: ???? Step 3: Biggie Smalls in the shape of an X" />

  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@WowItIsBryce" />

  <link rel="stylesheet" href="/css/main.css">
  <link rel="icon"  type="image/png" href="/favicon.png">
  <link rel="canonical" href="https://brycestevenwilley.github.io/2022/04/fpt_tts_biggie">
  <link rel="alternate" type="application/rss+xml" title="Bryce Willey" href="https://brycestevenwilley.github.io/feed.xml">
</head>

  <body>
    <header class="site-header" role="banner">
  <div class="wrapper">
    
    
    
    <nav class="c-navigation spread">
      <a href="/">
        <img src="/assets/site-logo.png" alt="Bryce's Website Logo" width="56px" height="40px" />
        <div class="c-navigation__item ">Bryce Willey</div>
      </a>
      <div class="spacer"></div>
      <input type="checkbox" id="nav-trigger" class="nav-trigger" />
      <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
      </label>
      <div class="c-navigation__container trigger">
        
          
          
               
              <a class="c-navigation__item " href="/about/">About</a>
              
          
        
          
          
        
          
          
               
              <a class="c-navigation__item " href="/now/">Now</a>
              
          
        
          
          
        
          
          
        
          
          
        
          
          
        
          
          
               
              <a class="c-navigation__item " href="/blogs/">Blogs</a>
              
          
        
          
          
               
              <a class="c-navigation__item " href="/projects/">Projects</a>
              
          
        
          
          
               
              <a class="c-navigation__item " href="/image-gallery">Image Gallery</a>
              
          
        
          
          
        
        <a class="c-navigation__item" href="/assets/bryce_willey_resume.pdf">Resume</a>
      </div>
    </nav>
    

  </div>
</header>

    <main>
    <article class="c-article">
  <header class="c-header c-article__header">
    <div class="u-container">
      <h1 class="c-header__title">Mystery Internet Bug: Text-to-Speech and The Notorious B.I.G.</h1>
      <!-- Note! Header images should try to be less than 315 height to
           limit the size of the header banner. -->
      <!-- https://developer.mozilla.org/en-US/docs/Learn/HTML/Multimedia_and_embedding/Responsive_images#art_direction -->
       
        <picture class="headerImgW no-radius">
          <source media="(max-width: 799px)" srcset="/assets/headers/biggie-tts.png">
          <source media="(min-width: 800px)" srcset="/assets/headers/biggie-tts.png">
          <img class="headerImg no-radius" src="/assets/headers/biggie-tts.png"
               width="500px"
               height="250px"
               alt="A diagram of a 3 step plan. Step 1: text-to-speech (represented by an audio icon). Step 2: ???? Step 3: Biggie Smalls in the shape of an X">
        </picture>
        <p></p>
      
      
      <p class="c-header__subtitle">Apr 20th, 2022</p>
      <p class="c-header__subtitle">1777 words (~8 minutes)</p>
      
    </div>
  </header>

  <div class="c-article__main">
    <aside>
This post was originally a <a href="https://twitter.com/wowitisbryce/status/1515794042444996610">tweet thread</a>.
I've added more details and background explanations where possible, and rewritten it for the blog format.
</aside>

<p>I love solving random bugs on the internet! 
Recently, Iâ€™ve gotten more comfortable with browser development tools.
Sometimes Iâ€™ll be on a website and realize, â€œHey, I can open this up and see how it works!â€ 
As a result, Iâ€™ve had a lot of fun finding bugs on random websites and figuring out why they happen.</p>

<p>This postâ€™s target bug is getting the landing page demo of <a href="https://fpt.ai/tts">FPTâ€™s text-to-speech service</a> to play a mashup of Notorious B.I.Gâ€™s â€œJuicyâ€ and the xxâ€™s â€œVCRâ€. Iâ€™ll walk through all of the steps I took, explaining each the best I can. 
You shouldnâ€™t need to know Javascript or web technologies to follow along. As long as you know the general ideas of what a web page is (and that Javascript is just the code that handles interactions on a web page) youâ€™ll be good.</p>

<h2 id="how-i-found-the-site-in-the-first-place">How I found the site in the first place</h2>

<p>Iâ€™ve been teaching myself Vietnamese for a while now, using some combination of Duolingo, the Foreign Service Instituteâ€™s <a href="https://www.fsi-language-courses.org/fsi-vietnamese-basic-course/">Vietnamese Course</a>, and <a href="https://apps.ankiweb.net/">Anki</a> (a digital flash card app).
To make flash cards for vocabulary, I need the Vietnamese word, its English translation, and an audio clip of the Vietnamese pronunciation. Getting the audio clip is the harder part; you have to find a good audio source for the sound, open up an audio editor, and clip out individual words. I started using text-to-speech (TTS) apps to avoid that complicated process. <a href="https://soundoftext.com/">Sound of Text</a> (and itâ€™s paid version, <a href="https://hearling.com/">Hearling</a>) are useful, but they both use Vietnameseâ€™s northern, or Hanoi, dialect. From what I can tell, in Boston most people speak the southern dialect. Looking for an alternative TTS service led me to <a href="https://fpt.ai/tts">FPT.ai</a>, a Vietnamese based software company.</p>

<h2 id="reproducing-the-bug">Reproducing the bug</h2>

<p>The front page of FPTâ€™s text-to-speech service has a place where you can try it out yourself, and it works fine. If you copy my favorite tongue twister, â€œTÃ´i la, â€˜LÃ¡ láº¡ lÃ  lÃ¡ Ä‘á»™c!â€™â€ (I yell, â€œthe strange leaf is the poison leaf!â€) into the text area, and click â€œGenerate Audioâ€, thereâ€™s a short loading sound, followed by the text-to-speech audio.</p>

<p>However, we came here to get generate the <em>southern accent</em>. If you select the â€œLan Nhiâ€ accent, and type â€œdáº¡â€ (â€œyesâ€, one of the words that is pronounced differently between the north and south), the loading sound keeps playing. Thenâ€¦ Biggie starts singing?</p>

<p><img src="/assets/biggie-tts/form.png" alt="A web form on the fpt.ai/tts site. The first box is where you enter vietnamese text, the second lets you choose you voice and accent, and the third lets you say how fast to read the text. At the bottom of the image, three dots, the loading icon, are moving, indicating the sound is still loading." /></p>

<p>This keeps on for the entire song. The lines are from <a href="https://www.youtube.com/watch?v=_JZom_gVfuw">Juicy</a>, but the instrumental is different. Another thing to note is that the loading icon keeps repeating, so we can guess itâ€™s that the text-to-speech service isnâ€™t returning this response.</p>

<p>What specifically hooked me about this weirdness is that FPTâ€™s site seems otherwise well developed. It looks pretty sleek, and the rest of the site works for from what I can tell. So finding what seemed like an easter egg on the productâ€™s front page was surprising.</p>

<h2 id="mystery-1-why-biggie">Mystery 1: Why Biggie?</h2>

<p>First thing I always do when something unexpected happens on a website is to go to the dev tools! The keyboard shortcut to get there in either Firefox or Chrome is F12 or Control-Shift-J. Thereâ€™s a whole lot going on in browser dev tools, but weâ€™re only going to need 3 tabs:</p>
<ul>
  <li>Console: shows any logs from the webpage, letâ€™s you type Javascript to run</li>
  <li>Debugger (called â€œSourcesâ€ in Chrome): shows you all of the pageâ€™s Javascript code</li>
  <li>Network: shows all of the network requests from your browser to the web site.</li>
</ul>

<p>First, click on the â€œConsole tabâ€. Weâ€™re lucky enough that the most recent console log completely gives away the weirdest part of this mystery.</p>

<p><img src="/assets/biggie-tts/https-warning.png" alt="A console log line that says: &quot;Loading mixed (insecure) display content â€œhttp://kolber.github.io/audiojs/demos/mp3/juicy.mp3â€ on a secure page&quot;" /></p>

<p>This warning tells us that the audio playing is being served over HTTP, not HTTPS. Decomposing the jargon, HTTP (which stands for HyperText Transfer Protocol) is what the web runs on. Any time you visit a page on a website, your browser uses HTTP to ask the website for that specific page, and the website uses HTTP to send the page back to you. 
HTTPS uses asymmetric key encryption to keep those pages secret from any one in the middle who might be listening.</p>

<aside>
Fun fact: before HTTPS was common, you could easily copy other people's cookies on the same wifi network as you and literally sign in as them on Facebook. There was even a <a href="https://codebutler.github.io/firesheep/">Firefox extension that did it for you</a>.
</aside>

<p>This warning happens because the Javascript code on the page is using plain HTTP to download the song, even though the pageâ€™s original connection is made using HTTPS.</p>

<p>Back to the main mystery, the console gives us the exact URL of the song: <a href="http://kolber.github.io/audiojs/demos/mp3/juicy.mp3">http://kolber.github.io/audiojs/demos/mp3/juicy.mp3</a>.</p>

<audio controls="controls" src="http://kolber.github.io/audiojs/demos/mp3/juicy.mp3"> </audio>

<p>The root page of that site is just <a href="http://kolber.github.io/audiojs/">the landing page</a> for <a href="https://github.com/kolber/audiojs">audio.js</a>, a Javascript library that plays audio, either using HTML 5 features or Flash apps, back when they were a thing. If we look around the GitHub for the project, we can find that they replaced <code class="language-plaintext highlighter-rouge">juicy.mp3</code> with royalty-free Creative Commons licensed tracks <a href="https://github.com/kolber/audiojs/pull/205">back in 2016</a>. And going even further back, we can find that they removed the <code class="language-plaintext highlighter-rouge">juicy.mp3</code> file from the main project <a href="https://github.com/kolber/audiojs/commit/eb3f2bb63e7a9c986f05f30270930ba0a94ff3b0">back in 2010</a>. However, the mp3 files stayed on the <a href="https://github.com/kolber/audiojs/tree/gh-pages">GitHub pages website</a>, and werenâ€™t updated when the main project replaced everything with the Creative Commons tracks.</p>

<p>If we download the <a href="https://github.com/kolber/audiojs/blob/gh-pages/demos/mp3/juicy.mp3">MP3 itself</a>, we get the MP3â€™s album cover as well:</p>

<p><img src="/assets/biggie-tts/notorious-xx-album-cover.jpg" alt="The Album cover of the mystery song. The top left says &quot;...?&quot;, the top right says, &quot;wait what&quot;, and the bottom says &quot;the notorious xx&quot;, with a &quot;Parental Advisory: Explicit Content&quot; sticker in the bottom left. The middle is the mask in the shape of an X over the face of Biggie Smalls" /></p>

<p>The <a href="https://waitwhat.bandcamp.com/album/the-notorious-xx">whole album</a> is a mashup of Biggie and the xx by <a href="http://waitwhatmusic.com/">waitwhat</a>, who does all sorts of indie-rock hip-hop mashups. The instrumental is the <a href="https://www.youtube.com/watch?v=gI2eO_mNM88">xxâ€™s VCR</a>. The mash-up is pretty good in my opinion,
but itâ€™s probably not the choice I would have made for the demo code of a library.</p>

<p>But we still havenâ€™t answered an important question, where is this mashup even being played? Itâ€™s included as a demo in <code class="language-plaintext highlighter-rouge">audio.js</code>, but none of the library
code itself is playing it. To answer this, weâ€™d need to be able to search through all of the HTML, Javascript, and CSS code that is downloaded when we visit a webpage. Good thing we can do just that!</p>

<ul>
  <li>We can go to the â€œDebuggerâ€ tab (â€œSourcesâ€ in Chrome) of our still-open dev-tools.</li>
  <li>In Firefox, click anywhere in the tab and press Control-Shift-Fâ€ to bring up the â€œfind in filesâ€ search bar
    <ul>
      <li>in Chrome, you can go to the â€œSourcesâ€ tab, and right click â€œTopâ€, then click â€œSearch all filesâ€</li>
    </ul>
  </li>
  <li>From there, we can search for â€œjuicy.mp3â€.</li>
</ul>

<p>We can see that the <code class="language-plaintext highlighter-rouge">functions.js</code> loads the mashup every time someone clicks on button (specifically, any HTML element with the <code class="language-plaintext highlighter-rouge">form-ai-speed</code>, <code class="language-plaintext highlighter-rouge">form-ai-btn</code>, or <code class="language-plaintext highlighter-rouge">btn</code> classes). Mystery solved!</p>

<p><img src="/assets/biggie-tts/debugger.png" alt="A view of the Firefox dev tools. We are searching all of the files from fpt.ai for the word &quot;juicy&quot;, which shows up in the functions.js file, being called in the audioJs() function. An `.on('click')` event handler is being added to the .form.ai-btn class." /></p>

<h2 id="mystery-2-why-dáº¡">Mystery 2: Why â€œdáº¡â€</h2>

<p>We arenâ€™t quite done yet: why did the input â€œdáº¡â€ trigger the bug, but not anything else? To figure this out, click over to the â€œNetworkâ€ tab of the dev tools. 
This tab lets you look at all of the information going between your browser and the website your visiting (or other sites).
When you get to the tab, refresh the page, wait for everything to load, then click the Trash can icon (in Chrome itâ€™s the ğŸš« icon) to clear up all of the irrelevant requests. Then, copy â€œdáº¡â€ in, and click â€œGenerate Audioâ€. Youâ€™ll get a few new requests pop up.</p>

<p><img src="/assets/biggie-tts/network-firefox.png" alt="The network tab of Firefox. There are three network requests, one to `kolber.github.io`, one to `www.google.com`, and one to `demo.fpt.ai`" />.</p>

<p>I have an ad blocker on my browser; without it youâ€™ll probably see a few more requests going to tracking sites and Facebook. These are the important ones:</p>
<ul>
  <li>a GET for the <code class="language-plaintext highlighter-rouge">juicy.mp3</code> that starts playing. From our previous sleuthing that, we know this happens immediately when the button is clicked.</li>
  <li>a POST to <code class="language-plaintext highlighter-rouge">www.google.com</code>. We can see that the initiator is <code class="language-plaintext highlighter-rouge">recaptcha__en.js</code>. <a href="https://developers.google.com/recaptcha/">reCAPTCHA</a> is the â€œIâ€™m not a robotâ€ checkbox you see on a lot of pages, and in this case is here to make sure that weâ€™re not a bot taking advantage of FPTâ€™s API without making an account first.</li>
  <li>a POST to <code class="language-plaintext highlighter-rouge">demo.fpt.ai</code>. This is the one we want to look at! If you click on that line, youâ€™ll see some more info about the request, and if you go to the â€œResponseâ€ tab of the request, youâ€™ll see that there was an error: â€œBody must have at least 3 charactersâ€. Which explains it: even though â€œdáº¡â€ is a valid word, the API isnâ€™t meant to handle individual words, itâ€™s built for full sentences and longer paragraphs.</li>
</ul>

<h2 id="conclusions">Conclusions</h2>

<p>Thereâ€™s not a clear moral of this story. As cool as it is, maybe donâ€™t use unlicensed mashups in your demo projects; itâ€™s caused some legal issues with other projects before and <a href="https://github.blog/2020-11-16-standing-up-for-developers-youtube-dl-is-back/">caused them to be copyright-striked</a> until they <a href="https://github.com/animelover1984/youtube-dl/commit/0851123c1909558268e8e237214d9c466cf5198d">removed the offending content</a>.</p>

<p>My take-away is that doing detective work like this is fun. Iâ€™ve started doing it a lot more since getting comfortable with Javascript and web dev in general. <a href="https://jvns.ca/blog/2022/03/10/how-to-use-undocumented-web-apis/">Julia Evans wrote another great post</a> about doing this sort of thing with web APIs.</p>

<p>If you want to dive more into dev tools, you can go to <a href="https://firefox-dev.tools/">Firefoxâ€™s documentation</a>, or <a href="https://developer.chrome.com/docs/devtools/">Chromeâ€™s documentation</a>.</p>


  </div>
</article>

    </main>
    <footer class="c-footer">
  <div class="u-container c-footer__container">
    <p>&copy; Bryce Willey 2022</p>
    <p class="social-links">
      <a href="mailto:bryce.steven.willey@gmail.com">bryce.steven.willey@gmail.com</a>
      <a href="https://twitter.com/wowitisbryce">Twitter</a>
      <a rel="me" href="https://weirder.earth/@brycew">Mastodon</a>
      <a href="https://github.com/BryceStevenWilley">Github</a>
      <a href="assets/gpg_key.gpg.txt">GPG Keys</a>
      
      
      <a href="https://brycestevenwilley.github.io/feed.xml">RSS Feed</a>
    </p>
  </div>
</footer>

  </body>
</html>
